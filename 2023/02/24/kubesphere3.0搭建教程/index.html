<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>kubesphere3.0搭建教程 | 故友的学习录</title><meta name="keywords" content="k8s"><meta name="author" content="Gu you"><meta name="copyright" content="Gu you"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="kubesphere3.0的安装文档基于kubernetes1.17.3环境安装kubesphere3.0的安装文档 本文档主要是在centos7系统下基于kubernetes1.17.3环境安装kubesphere3.0的安装文档。 环境准备系统要求本地虚拟机三台 要求：centos7.6~7.8，以下为 https:&#x2F;&#x2F;kuboard.cn&#x2F;install&#x2F;install-k8s.html#%">
<meta property="og:type" content="article">
<meta property="og:title" content="kubesphere3.0搭建教程">
<meta property="og:url" content="http://guyou1024.com/2023/02/24/kubesphere3.0%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="故友的学习录">
<meta property="og:description" content="kubesphere3.0的安装文档基于kubernetes1.17.3环境安装kubesphere3.0的安装文档 本文档主要是在centos7系统下基于kubernetes1.17.3环境安装kubesphere3.0的安装文档。 环境准备系统要求本地虚拟机三台 要求：centos7.6~7.8，以下为 https:&#x2F;&#x2F;kuboard.cn&#x2F;install&#x2F;install-k8s.html#%">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image000.png">
<meta property="article:published_time" content="2023-02-24T08:30:14.000Z">
<meta property="article:modified_time" content="2023-02-25T05:45:22.228Z">
<meta property="article:author" content="Gu you">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image000.png"><link rel="shortcut icon" href="/custom/img/favicon.jpg"><link rel="canonical" href="http://guyou1024.com/2023/02/24/kubesphere3.0%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'kubesphere3.0搭建教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-25 13:45:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/css/custom.css"><link rel="stylesheet" href="/custom/css/icon_font.css"><link href="https://cdn.bootcdn.net/ajax/libs/botui/0.3.9/botui-theme-default.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/custom/img/tx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">故友的学习录</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">kubesphere3.0搭建教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-24T08:30:14.000Z" title="发表于 2023-02-24 16:30:14">2023-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-25T05:45:22.228Z" title="更新于 2023-02-25 13:45:22">2023-02-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="kubesphere3.0搭建教程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="kubesphere3-0的安装文档"><a href="#kubesphere3-0的安装文档" class="headerlink" title="kubesphere3.0的安装文档"></a>kubesphere3.0的安装文档</h1><p>基于<code>kubernetes1.17.3</code>环境安装<code>kubesphere3.0</code>的安装文档</p>
<p>本文档主要是在<code>centos7</code>系统下基于<code>kubernetes1.17.3</code>环境安装<code>kubesphere3.0</code>的安装文档。</p>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><p>本地虚拟机三台</p>
<p>要求：centos7.6~7.8，以下为</p>
<p><a target="_blank" rel="noopener" href="https://kuboard.cn/install/install-k8s.html#%E6%A3%80%E6%9F%A5-centos-hostname">https://kuboard.cn/install/install-k8s.html#%E6%A3%80%E6%9F%A5-centos-hostname</a> 网站的检验结果。</p>
<table>
<thead>
<tr>
<th>CentOS 版本</th>
<th>本文档是否兼容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>7.8</td>
<td>是</td>
<td>已经验证</td>
</tr>
<tr>
<td>7.7</td>
<td>是</td>
<td>已经验证</td>
</tr>
<tr>
<td>7.6</td>
<td>是</td>
<td>已经验证</td>
</tr>
<tr>
<td>7.5</td>
<td>否</td>
<td>已证实会出现 kubelet 无法启动的问题</td>
</tr>
<tr>
<td>7.4</td>
<td>否</td>
<td>已证实会出现 kubelet 无法启动的问题</td>
</tr>
<tr>
<td>7.3</td>
<td>否</td>
<td>已证实会出现 kubelet 无法启动的问题</td>
</tr>
<tr>
<td>7.2</td>
<td>否</td>
<td>已证实会出现 kubelet 无法启动的问题</td>
</tr>
</tbody></table>
<p>本次安装使用的是<code>CentOS Linux release 7.9.2009 (Core)</code>版本，本人验证能安装成功。</p>
<h2 id="虚拟机安装步骤"><a href="#虚拟机安装步骤" class="headerlink" title="虚拟机安装步骤"></a>虚拟机安装步骤</h2><p>安装虚拟机比较的简单，这里不做介绍。</p>
<h3 id="创建客户机的向导"><a href="#创建客户机的向导" class="headerlink" title="创建客户机的向导"></a>创建客户机的向导</h3><h4 id="创建新的虚拟机"><a href="#创建新的虚拟机" class="headerlink" title="创建新的虚拟机"></a>创建新的虚拟机</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image001.png" alt="img"></p>
<p>点击创建新的虚拟机。</p>
<h4 id="新建虚拟机向导"><a href="#新建虚拟机向导" class="headerlink" title="新建虚拟机向导"></a>新建虚拟机向导</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image002.png" alt="img"></p>
<p>选择典型，点击下一步。</p>
<h4 id="安装客户机的操作系统"><a href="#安装客户机的操作系统" class="headerlink" title="安装客户机的操作系统"></a>安装客户机的操作系统</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image003.png" alt="img"></p>
<p>选择稍后安装操作系统，点击下一步。</p>
<h4 id="选择客户机的操作系统类型"><a href="#选择客户机的操作系统类型" class="headerlink" title="选择客户机的操作系统类型"></a>选择客户机的操作系统类型</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image004.png" alt="img"></p>
<p>我们这里安装的Linux Centos7版本。这里我们选择的Linux系统。版本选择Redhat Enterpise Linux7 64位。</p>
<h4 id="命名客户机和存储位置"><a href="#命名客户机和存储位置" class="headerlink" title="命名客户机和存储位置"></a>命名客户机和存储位置</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image005.png" alt="img"></p>
<p>这里根据自己的情况设置客户机的名称以及客户存储的本地的位置。</p>
<h4 id="配置客户机的磁盘的大小"><a href="#配置客户机的磁盘的大小" class="headerlink" title="配置客户机的磁盘的大小"></a>配置客户机的磁盘的大小</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image006.png" alt="img"></p>
<p>默认给出的20G，这里我设置的大一写。设置成100G。点击下一步。</p>
<h4 id="已经准备创建好的客户机"><a href="#已经准备创建好的客户机" class="headerlink" title="已经准备创建好的客户机"></a>已经准备创建好的客户机</h4><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image007.png" alt="img"></p>
<p>点击完成。基本的客户机的创建向导完成。</p>
<h4 id="配置客户机的属性"><a href="#配置客户机的属性" class="headerlink" title="配置客户机的属性"></a>配置客户机的属性</h4><h5 id="内存配置大小"><a href="#内存配置大小" class="headerlink" title="内存配置大小"></a>内存配置大小</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image008.png" alt="img"></p>
<p>这里我们一般设置成企业：8G、个人使用2G做演示。</p>
<h5 id="处理器配置"><a href="#处理器配置" class="headerlink" title="处理器配置"></a>处理器配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image009.png" alt="img"></p>
<p>处理器配置，我们一般配置成2个处理器。</p>
<h5 id="硬盘配置"><a href="#硬盘配置" class="headerlink" title="硬盘配置"></a>硬盘配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image010.png" alt="img"></p>
<p>这里默认选择。不需要操作。</p>
<h5 id="CD-DVD配置"><a href="#CD-DVD配置" class="headerlink" title="CD/DVD配置"></a>CD/DVD配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image011.png" alt="img"></p>
<p>设备状态设置成启动时连接，选择ISO镜像文件连接并配置好连接。</p>
<h5 id="网络适配器配置"><a href="#网络适配器配置" class="headerlink" title="网络适配器配置"></a>网络适配器配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image012.png" alt="img"></p>
<p>在本地配置下我们使用的NAT模式。如果在企业搭建上，建议使用桥接模式。</p>
<h5 id="USB控制器配置"><a href="#USB控制器配置" class="headerlink" title="USB控制器配置"></a>USB控制器配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image013.png" alt="img"></p>
<p>对服务器来说，不需要该设备。移除即可。</p>
<h5 id="声卡配置"><a href="#声卡配置" class="headerlink" title="声卡配置"></a>声卡配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image014.png" alt="img"></p>
<p>对服务器来说，不需要该设备。移除即可。</p>
<h5 id="打印机配置"><a href="#打印机配置" class="headerlink" title="打印机配置"></a>打印机配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image015.png" alt="img"></p>
<p>对服务器来说，不需要该设备。移除即可。</p>
<h5 id="显示器配置"><a href="#显示器配置" class="headerlink" title="显示器配置"></a>显示器配置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image016.png" alt="img"></p>
<p>不需要操作，使用默认即可。</p>
<p>这里客户机的基本的配置基本完成。</p>
<h4 id="安装客户机的步骤"><a href="#安装客户机的步骤" class="headerlink" title="安装客户机的步骤"></a>安装客户机的步骤</h4><h5 id="开始安装客户机系统"><a href="#开始安装客户机系统" class="headerlink" title="开始安装客户机系统"></a>开始安装客户机系统</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image017.png" alt="img"></p>
<h5 id="按下回车开始安装配置虚拟机安装属性"><a href="#按下回车开始安装配置虚拟机安装属性" class="headerlink" title="按下回车开始安装配置虚拟机安装属性"></a>按下回车开始安装配置虚拟机安装属性</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image018.png" alt="img"></p>
<p>等待加载系统镜像完毕。</p>
<h5 id="选择客户机的系统语言"><a href="#选择客户机的系统语言" class="headerlink" title="选择客户机的系统语言"></a>选择客户机的系统语言</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image019.png" alt="img"></p>
<p>这里我们选择中文简体。点击继续。</p>
<h5 id="设置安装客户机的基本配置"><a href="#设置安装客户机的基本配置" class="headerlink" title="设置安装客户机的基本配置"></a>设置安装客户机的基本配置</h5><h6 id="安装选择类型"><a href="#安装选择类型" class="headerlink" title="安装选择类型"></a>安装选择类型</h6><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image020.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image021.png" alt="img"></p>
<p>点击完成。</p>
<h5 id="开始安装客户机系统-1"><a href="#开始安装客户机系统-1" class="headerlink" title="开始安装客户机系统"></a>开始安装客户机系统</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image022.png" alt="img"></p>
<p>点击开始安装。</p>
<h5 id="用户设置"><a href="#用户设置" class="headerlink" title="用户设置"></a>用户设置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image023.png" alt="img"></p>
<p>创建密码。自己记住即可。这里是管理员登录密码。</p>
<h5 id="安装系统进行中"><a href="#安装系统进行中" class="headerlink" title="安装系统进行中"></a>安装系统进行中</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image024.png" alt="img"></p>
<p>此处需要等待一段时间，不同的机器配置等待的时间不一致。</p>
<h5 id="初始化客户机的步骤"><a href="#初始化客户机的步骤" class="headerlink" title="初始化客户机的步骤"></a>初始化客户机的步骤</h5><p>安装成功之后，我们看到以下的图。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image025.png" alt="img"></p>
<p>点击重启即可。</p>
<h5 id="接受许可证"><a href="#接受许可证" class="headerlink" title="接受许可证"></a>接受许可证</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image026.png" alt="img"></p>
<p>勾选我同意许可协议。重启系统。输入用户名密码登录到系统。至此我们的系统客户机安装成功。</p>
<h5 id="系统欢迎页面"><a href="#系统欢迎页面" class="headerlink" title="系统欢迎页面"></a>系统欢迎页面</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image027.png" alt="img"></p>
<p>选择汉语，点击前进。</p>
<h5 id="自定义键盘输入法"><a href="#自定义键盘输入法" class="headerlink" title="自定义键盘输入法"></a>自定义键盘输入法</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image028.png" alt="img"></p>
<p>选择汉语，点击前进。</p>
<h5 id="隐私设置"><a href="#隐私设置" class="headerlink" title="隐私设置"></a>隐私设置</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image029.png" alt="img"></p>
<p>点击前进。</p>
<h5 id="在线登录账号"><a href="#在线登录账号" class="headerlink" title="在线登录账号"></a>在线登录账号</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image030.png" alt="img"></p>
<p>这里我们跳过即可。</p>
<h5 id="开始使用系统"><a href="#开始使用系统" class="headerlink" title="开始使用系统"></a>开始使用系统</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image031.png" alt="img"></p>
<h5 id="打开终端输入命令行查询IP地址"><a href="#打开终端输入命令行查询IP地址" class="headerlink" title="打开终端输入命令行查询IP地址"></a>打开终端输入命令行查询IP地址</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image032.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image033.png" alt="img"></p>
<p>我们连接的<code>ens33</code>的网卡，因此我们得到的本地的IP地址为：192.168.196.128，这里每个人的IP地址不一样。根据自己的实际情况获取IP地址。</p>
<h5 id="注意，如果没有ip显示："><a href="#注意，如果没有ip显示：" class="headerlink" title="注意，如果没有ip显示："></a>注意，如果没有ip显示：</h5><p>你可以在<code>/etc/sysconfig/network-scripts</code> 这个目录下面的<code>ifcfg-ens33</code>这个文件里面的<code>ONBOOT=no</code>，修改成<code>ONBOOT=yes</code>，然后通过命于重新启动网络服务。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image034.png" alt="img"></p>
<p>重新启动网络服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/network restart 或 service network restart</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image035.png" alt="img"></p>
<p>然后可设置静态网络ip：</p>
<p>设置静态ip的话，一定要记住，设置<code>GATEWAY</code>网关的时候要跟虚拟网络编辑器的网关要一致，否则无法上网！！！</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image036.png" alt="img"></p>
<p>设置完静态IP以后重新启动网络服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/network restart 或 service network restart</span><br></pre></td></tr></table></figure>

<p>然后测试能不能上网:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image037.png" alt="img"></p>
<h5 id="使用外部客户端工具连接"><a href="#使用外部客户端工具连接" class="headerlink" title="使用外部客户端工具连接"></a>使用外部客户端工具连接</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image038.png" alt="img"></p>
<p>这里虚拟机安装centos7系统完成。</p>
<p>安装安装上述的安装方式，需要安装三台虚拟机。</p>
<h2 id="虚拟机环境如下"><a href="#虚拟机环境如下" class="headerlink" title="虚拟机环境如下"></a>虚拟机环境如下</h2><table>
<thead>
<tr>
<th>IP地址</th>
<th>说明</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.142.144</td>
<td>master节点</td>
<td>8G内存 4核CPU</td>
</tr>
<tr>
<td>192.168.142.145</td>
<td>node1节点</td>
<td>8G内存 4核CPU</td>
</tr>
<tr>
<td>192.168.142.146</td>
<td>node2节点</td>
<td>8G内存 4核CPU</td>
</tr>
</tbody></table>
<h2 id="前置步骤说明"><a href="#前置步骤说明" class="headerlink" title="前置步骤说明"></a>前置步骤说明</h2><ol>
<li>centos 版本为 7.6 或 7.7、CPU 内核数量大于等于 2，且内存大于等于 4G。</li>
<li>hostname 不是 localhost，且不包含下划线、小数点、大写字母。</li>
<li>任意节点都有固定的内网 IP 地址(集群机器统一内网)。</li>
<li>任意节点上 IP 地址 可互通（无需 NAT 映射即可相互访问），且没有防火墙、安全组隔离。</li>
<li>任意节点不会直接使用 docker run 或 docker-compose 运行容器，Pod。</li>
</ol>
<h3 id="安装基础工具"><a href="#安装基础工具" class="headerlink" title="安装基础工具"></a>安装基础工具</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; yum install -y vim &amp;&amp; yum install -y lsof &amp;&amp; yum install -y net-tools </span><br></pre></td></tr></table></figure>



<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image039.png" alt="img"></p>
<h3 id="配置hosts的地址名称"><a href="#配置hosts的地址名称" class="headerlink" title="配置hosts的地址名称"></a>配置hosts的地址名称</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts   </span><br><span class="line">192.168.142.147 k8s-node1 </span><br><span class="line">192.168.142.148 k8s-node2 </span><br><span class="line">192.168.142.149 k8s-node3 </span><br></pre></td></tr></table></figure>

<p>设置服务器hostname</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定新的hostname</span></span><br><span class="line">hostnamectl set-hostname &lt;newhostname&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换过来</span></span><br><span class="line">su </span><br></pre></td></tr></table></figure>

<h3 id="关闭防火墙或者阿里云开通安全组端口访问"><a href="#关闭防火墙或者阿里云开通安全组端口访问" class="headerlink" title="关闭防火墙或者阿里云开通安全组端口访问"></a>关闭防火墙或者阿里云开通安全组端口访问</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行关闭命令</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次执行查看防火墙命令</span></span><br><span class="line">systemctl status firewalld.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行开机禁用防火墙自启命令</span></span><br><span class="line">systemctl disable firewalld.service </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image040.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image041.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image042.png" alt="img"></p>
<h3 id="关闭-selinux"><a href="#关闭-selinux" class="headerlink" title="关闭 selinux"></a>关闭 selinux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config setenforce 0 cat /etc/selinux/config </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image043.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image044.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image045.png" alt="img"></p>
<h3 id="关闭-swap"><a href="#关闭-swap" class="headerlink" title="关闭 swap"></a>关闭 swap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 临时</span></span><br><span class="line">swapoff -a </span><br><span class="line"><span class="meta">#</span><span class="bash"> 永久</span> </span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br><span class="line">free -l -h </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image046.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image047.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image048.png" alt="img"></p>
<h3 id="将桥接的-IPv4-流量传递到-iptables-的链"><a href="#将桥接的-IPv4-流量传递到-iptables-的链" class="headerlink" title="将桥接的 IPv4 流量传递到 iptables 的链"></a>将桥接的 <code>IPv4</code> 流量传递到 <code>iptables</code> 的链</h3><h4 id="如果没有-etc-sysctl-conf文件的话直接执行"><a href="#如果没有-etc-sysctl-conf文件的话直接执行" class="headerlink" title="如果没有/etc/sysctl.conf文件的话直接执行"></a>如果没有<code>/etc/sysctl.conf</code>文件的话直接执行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.bridge.bridge-nf-call-ip6tables = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.bridge.bridge-nf-call-iptables = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv6.conf.all.disable_ipv6 = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv6.conf.default.disable_ipv6 = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv6.conf.lo.disable_ipv6 = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv6.conf.all.forwarding = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image049.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image050.png" alt="img"></p>
<h4 id="如果有该文件可以执行以下命令"><a href="#如果有该文件可以执行以下命令" class="headerlink" title="如果有该文件可以执行以下命令"></a>如果有该文件可以执行以下命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s#^net.ipv4.ip_forward.*#net.ipv4.ip_forward=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.bridge.bridge-nf-call-ip6tables.*#net.bridge.bridge-nf-call-ip6tables=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.bridge.bridge-nf-call-iptables.*#net.bridge.bridge-nf-call-iptables=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.ipv6.conf.all.disable_ipv6.*#net.ipv6.conf.all.disable_ipv6=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.ipv6.conf.default.disable_ipv6.*#net.ipv6.conf.default.disable_ipv6=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.ipv6.conf.lo.disable_ipv6.*#net.ipv6.conf.lo.disable_ipv6=1#g&quot; /etc/sysctl.conf </span><br><span class="line">sed -i &quot;s#^net.ipv6.conf.all.forwarding.*#net.ipv6.conf.all.forwarding=1#g&quot; /etc/sysctl.conf </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image051.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image052.png" alt="img"></p>
<h4 id="执行命令以应用"><a href="#执行命令以应用" class="headerlink" title="执行命令以应用"></a>执行命令以应用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image053.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image054.png" alt="img"></p>
<h3 id="安装Docker环境（所有节点）"><a href="#安装Docker环境（所有节点）" class="headerlink" title="安装Docker环境（所有节点）"></a>安装Docker环境（所有节点）</h3><h4 id="卸载旧版本的docker"><a href="#卸载旧版本的docker" class="headerlink" title="卸载旧版本的docker"></a>卸载旧版本的docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-engine </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image055.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image056.png" alt="img"></p>
<h4 id="安装基础依赖"><a href="#安装基础依赖" class="headerlink" title="安装基础依赖"></a>安装基础依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \ device-mapper-persistent-data \ lvm2 </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image057.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image058.png" alt="img"></p>
<h4 id="配置docker-yum源"><a href="#配置docker-yum源" class="headerlink" title="配置docker yum源"></a>配置docker yum源</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image059.png" alt="img"></p>
<h4 id="安装并启动-docker"><a href="#安装并启动-docker" class="headerlink" title="安装并启动 docker"></a>安装并启动 docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce-19.03.8 docker-ce-cli-19.03.8 containerd.io </span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl start docker</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image060.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image061.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image062.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image063.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image064.png" alt="img"></p>
<h4 id="配置docker加速"><a href="#配置docker加速" class="headerlink" title="配置docker加速"></a>配置docker加速</h4><h5 id="创建docker加速文件夹"><a href="#创建docker加速文件夹" class="headerlink" title="创建docker加速文件夹"></a>创建docker加速文件夹</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker </span><br></pre></td></tr></table></figure>

<h5 id="登录阿里云获取镜像"><a href="#登录阿里云获取镜像" class="headerlink" title="登录阿里云获取镜像"></a>登录阿里云获取镜像</h5><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image065.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image066.png" alt="img"></p>
<p>如果没有的话，需要手动输入“容器镜像服务”。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image067.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image068.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27; &#123;  &quot;registry-mirrors&quot;: [&quot;https://11l3ppzn.mirror.aliyuncs.com&quot;] &#125; EOF </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image069.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image070.png" alt="img"></p>
<h3 id="安装k8s环境"><a href="#安装k8s环境" class="headerlink" title="安装k8s环境"></a>安装k8s环境</h3><h4 id="安装k8s、kubelet、kubeadm、kubectl（所有节点）"><a href="#安装k8s、kubelet、kubeadm、kubectl（所有节点）" class="headerlink" title="安装k8s、kubelet、kubeadm、kubectl（所有节点）"></a>安装k8s、kubelet、kubeadm、kubectl（所有节点）</h4><h5 id="配置K8S的yum源"><a href="#配置K8S的yum源" class="headerlink" title="配置K8S的yum源"></a>配置K8S的yum源</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg     http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image071.png" alt="img"></p>
<h5 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove -y kubelet kubeadm kubectl </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image072.png" alt="img"></p>
<h5 id="安装kubelet、kubeadm、kubectl"><a href="#安装kubelet、kubeadm、kubectl" class="headerlink" title="安装kubelet、kubeadm、kubectl"></a>安装kubelet、kubeadm、kubectl</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3 </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image073.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image074.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image075.png" alt="img"></p>
<p>必须等待三台主机安装成功。</p>
<h5 id="开机启动和重启kubelet"><a href="#开机启动和重启kubelet" class="headerlink" title="开机启动和重启kubelet"></a>开机启动和重启kubelet</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image076.png" alt="img"></p>
<p>注意，如果此时查看kubelet的状态，他会无限重启，等待接收集群命令，和初始化。这个是正常的。</p>
<h4 id="初始化所有节点"><a href="#初始化所有节点" class="headerlink" title="初始化所有节点"></a>初始化所有节点</h4><h5 id="创建一个shell脚本内容如下"><a href="#创建一个shell脚本内容如下" class="headerlink" title="创建一个shell脚本内容如下"></a>创建一个shell脚本内容如下</h5><p>新建一个shell脚本名称为<code>image.sh</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi images.sh </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span> </span><br><span class="line">images=(  kube-apiserver:v1.17.3   kube-proxy:v1.17.3  kube-controller-manager:v1.17.3  kube-scheduler:v1.17.3  coredns:1.6.5  etcd:3.4.3-0   pause:3.1 ) for imageName in $&#123;images[@]&#125;;do docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName done </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image077.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image078.png" alt="img"></p>
<h5 id="将该脚本授予可执行的权限"><a href="#将该脚本授予可执行的权限" class="headerlink" title="将该脚本授予可执行的权限"></a>将该脚本授予可执行的权限</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 700 images.sh</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image079.png" alt="img"></p>
<h5 id="执行该脚本命令"><a href="#执行该脚本命令" class="headerlink" title="执行该脚本命令"></a>执行该脚本命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./images.sh</span><br></pre></td></tr></table></figure>

<p>比较慢，耐心等待 </p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image080.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image081.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image082.png" alt="img"></p>
<h5 id="初始化master节点"><a href="#初始化master节点" class="headerlink" title="初始化master节点"></a>初始化master节点</h5><p><strong>注意，该操作只是在master节点之后构建环境。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.142.144 \</span><br><span class="line">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.17.3 \</span><br><span class="line">--service-cidr=10.96.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>



<p><strong>–apiserver-advertise-address=10.12.0.9 这里的地址需要修改成master对应的IP地址。</strong></p>
<h6 id="如果输入以上内容报错："><a href="#如果输入以上内容报错：" class="headerlink" title="如果输入以上内容报错："></a>如果输入以上内容报错：</h6><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image083.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1</span><br><span class="line">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span><br><span class="line">To see the stack trace of this error execute with --v=5 or higher</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;1&quot; &gt;/proc/sys/net/bridge/bridge-nf-call-iptables</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image084.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image085.png" alt="img"></p>
<p>初始化完成。</p>
<h5 id="配置-kubectl"><a href="#配置-kubectl" class="headerlink" title="配置 kubectl"></a>配置 kubectl</h5><p>这里注意的是，一定成初始化成功后面获取复制。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image086.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image087.png" alt="img"></p>
<h5 id="部署网络插件"><a href="#部署网络插件" class="headerlink" title="部署网络插件"></a>部署网络插件</h5><p>本次使用的是<code>calico-3.13.1.yaml</code>版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改地址可能会变动下载不到</span></span><br><span class="line">kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml </span><br></pre></td></tr></table></figure>

<p><code>calico-3.13.1.yaml</code>内容</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-config.yaml</span></span><br><span class="line"><span class="comment"># This ConfigMap is used to configure a self-hosted Calico installation.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># Typha is disabled.</span></span><br><span class="line">  <span class="attr">typha_service_name:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">  <span class="comment"># Configure the backend to use.</span></span><br><span class="line">  <span class="attr">calico_backend:</span> <span class="string">&quot;bird&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Configure the MTU to use</span></span><br><span class="line">  <span class="attr">veth_mtu:</span> <span class="string">&quot;1440&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The CNI network configuration to install on each node.  The special</span></span><br><span class="line">  <span class="comment"># values in this config will be automatically populated.</span></span><br><span class="line">  <span class="attr">cni_network_config:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;k8s-pod-network&quot;,</span></span><br><span class="line"><span class="string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;plugins&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;calico&quot;,</span></span><br><span class="line"><span class="string">          &quot;log_level&quot;: &quot;info&quot;,</span></span><br><span class="line"><span class="string">          &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span></span><br><span class="line"><span class="string">          &quot;nodename&quot;: &quot;__KUBERNETES_NODE_NAME__&quot;,</span></span><br><span class="line"><span class="string">          &quot;mtu&quot;: __CNI_MTU__,</span></span><br><span class="line"><span class="string">          &quot;ipam&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;type&quot;: &quot;calico-ipam&quot;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &quot;policy&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;type&quot;: &quot;k8s&quot;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &quot;kubernetes&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;kubeconfig&quot;: &quot;__KUBECONFIG_FILEPATH__&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class="line"><span class="string">          &quot;snat&quot;: true,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;bandwidth&quot;,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;&quot;bandwidth&quot;: true&#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/kdd-crds.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bgpconfigurations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BGPConfiguration</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">bgpconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">bgpconfiguration</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bgppeers.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BGPPeer</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">bgppeers</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">bgppeer</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blockaffinities.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BlockAffinity</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">blockaffinities</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">blockaffinity</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">clusterinformations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">ClusterInformation</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">clusterinformation</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">felixconfigurations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">FelixConfiguration</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">felixconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">felixconfiguration</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">globalnetworkpolicies.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">GlobalNetworkPolicy</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">globalnetworkpolicies</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">globalnetworkpolicy</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">globalnetworksets.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">GlobalNetworkSet</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">globalnetworksets</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">globalnetworkset</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostendpoints.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">HostEndpoint</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">hostendpoints</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">hostendpoint</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamblocks.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMBlock</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamblocks</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamblock</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamconfigs.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMConfig</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamconfigs</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamconfig</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamhandles.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMHandle</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamhandle</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ippools.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPPool</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ippools</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ippool</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">networkpolicies.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">networkpolicies</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">networkpolicy</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">networksets.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">NetworkSet</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">networksets</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">networkset</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/rbac.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include a clusterrole for the kube-controllers component,</span></span><br><span class="line"><span class="comment"># and bind it to the calico-kube-controllers serviceaccount.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># Nodes are watched to monitor for deletions.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Pods are queried to check for existence.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># IPAM resources are manipulated when nodes are deleted.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">delete</span></span><br><span class="line">  <span class="comment"># Needs access to update clusterinformations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Include a clusterrole for the calico-node DaemonSet,</span></span><br><span class="line"><span class="comment"># and bind it to the calico-node serviceaccount.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># The CNI plugin needs to get pods, nodes, and namespaces.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="comment"># Used to discover service IPs for advertisement.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="comment"># Used to discover Typhas.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Pod CIDR auto-detection on kubeadm needs access to config maps.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="comment"># Needed for clearing NodeNetworkUnavailable flag.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">      <span class="comment"># Calico stores some configuration information in node annotations.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># Watch for changes to Kubernetes NetworkPolicies.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;networking.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networkpolicies</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="comment"># Used by Calico for policy information.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">serviceaccounts</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># The CNI plugin patches pods/status.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="comment"># Calico monitors various CRDs for config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalfelixconfigs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">felixconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgppeers</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalbgpconfigs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgpconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalnetworkpolicies</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalnetworksets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networkpolicies</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networksets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hostendpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># Calico must create and update some CRDs on startup.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">felixconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># Calico stores some configuration information on the node.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># These permissions are only requried for upgrade from v2.6, and can</span></span><br><span class="line">  <span class="comment"># be removed after upgrade or on fresh installations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgpconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgppeers</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># These permissions are required for Calico CNI to perform IPAM allocations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">delete</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamconfigs</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Block affinities must also be watchable by confd for route aggregation.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># The Calico IPAM migration needs to get daemonsets. These permissions can be</span></span><br><span class="line">  <span class="comment"># removed if not upgrading from an installation using host-local IPAM.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">daemonsets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-node.yaml</span></span><br><span class="line"><span class="comment"># This manifest installs the calico-node container, as well</span></span><br><span class="line"><span class="comment"># as the CNI plugins and network config on</span></span><br><span class="line"><span class="comment"># each master and worker node in a Kubernetes cluster.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="comment"># This, along with the CriticalAddonsOnly toleration below,</span></span><br><span class="line">        <span class="comment"># marks the pod as a critical add-on, ensuring it gets</span></span><br><span class="line">        <span class="comment"># priority scheduling and that its resources are reserved</span></span><br><span class="line">        <span class="comment"># if it ever gets evicted.</span></span><br><span class="line">        <span class="attr">scheduler.alpha.kubernetes.io/critical-pod:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="comment"># Make sure calico-node gets scheduled on all nodes.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="comment"># Mark the pod as a critical add-on for rescheduling.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CriticalAddonsOnly</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoExecute</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">calico-node</span></span><br><span class="line">      <span class="comment"># Minimize downtime during a rolling upgrade or deletion; tell Kubernetes to do a &quot;force</span></span><br><span class="line">      <span class="comment"># deletion&quot;: https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods.</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="comment"># This container performs upgrade from host-local IPAM to calico-ipam.</span></span><br><span class="line">        <span class="comment"># It can be deleted if this is a fresh installation, or if you have already</span></span><br><span class="line">        <span class="comment"># upgraded to use calico-ipam.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">upgrade-ipam</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">calico/cni:v3.13.1</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/opt/cni/bin/calico-ipam&quot;</span>, <span class="string">&quot;-upgrade&quot;</span>]</span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_NODE_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">calico_backend</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/cni/networks</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">host-local-net-dir</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/opt/cni/bin</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># This container installs the CNI binaries</span></span><br><span class="line">        <span class="comment"># and CNI network config file on each node.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">calico/cni:v3.13.1</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/install-cni.sh&quot;</span>]</span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Name of the CNI config file to create.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_CONF_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;10-calico.conflist&quot;</span></span><br><span class="line">            <span class="comment"># The CNI network config to install on each node.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_NETWORK_CONFIG</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">cni_network_config</span></span><br><span class="line">            <span class="comment"># Set the hostname based on the k8s node name.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_NODE_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="comment"># CNI MTU Config variable</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_MTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># Prevents the container from sleeping forever.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SLEEP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/opt/cni/bin</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># Adds a Flex Volume Driver that creates a per-pod Unix Domain Socket to allow Dikastes</span></span><br><span class="line">        <span class="comment"># to communicate with Felix over the Policy Sync API.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">calico/pod2daemon-flexvol:v3.13.1</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/host/driver</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="comment"># Runs calico-node container on each Kubernetes node.  This</span></span><br><span class="line">        <span class="comment"># container programs network policy and routes on each</span></span><br><span class="line">        <span class="comment"># host.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">calico/node:v3.13.1</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Use Kubernetes API as the backing datastore.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATASTORE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;kubernetes&quot;</span></span><br><span class="line">            <span class="comment"># Wait for the datastore.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WAIT_FOR_DATASTORE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="comment"># Set based on the k8s node name.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODENAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="comment"># Choose the backend to use.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">calico_backend</span></span><br><span class="line">            <span class="comment"># Cluster type to identify the deployment type</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLUSTER_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;k8s,bgp&quot;</span></span><br><span class="line">            <span class="comment"># Auto-detect the BGP IP address.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;autodetect&quot;</span></span><br><span class="line">            <span class="comment"># Enable IPIP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_IPIP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line">            <span class="comment"># Set MTU for tunnel device used if ipip is enabled</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_IPINIPMTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># The default IPv4 pool to create on startup if none exists. Pod IPs will be</span></span><br><span class="line">            <span class="comment"># chosen from this range. Changing this value after installation will have</span></span><br><span class="line">            <span class="comment"># no effect. This should fall within `--cluster-cidr`.</span></span><br><span class="line">            <span class="comment"># - name: CALICO_IPV4POOL_CIDR</span></span><br><span class="line">            <span class="comment">#   value: &quot;192.168.0.0/16&quot;</span></span><br><span class="line">            <span class="comment"># Disable file logging so `kubectl logs` works.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_DISABLE_FILE_LOGGING</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="comment"># Set Felix endpoint to host default action to ACCEPT.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_DEFAULTENDPOINTTOHOSTACTION</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">            <span class="comment"># Disable IPv6 on Kubernetes.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_IPV6SUPPORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">            <span class="comment"># Set Felix logging to &quot;info&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_LOGSEVERITYSCREEN</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;info&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_HEALTHENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-felix-live</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-bird-live</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-felix-ready</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-bird-ready</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/lib/modules</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/calico</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment"># Used by calico-node.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/lib/modules</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/run/calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br><span class="line">        <span class="comment"># Used to install CNI.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="comment"># Mount in the directory for host-local IPAM allocations. This is</span></span><br><span class="line">        <span class="comment"># used when upgrading from host-local to calico-ipam, and can be removed</span></span><br><span class="line">        <span class="comment"># if not using the upgrade-ipam init container.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-local-net-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/cni/networks</span></span><br><span class="line">        <span class="comment"># Used to create per-pod Unix Domain Sockets</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">        <span class="comment"># Used to install Flex Volume Driver</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/usr/libexec/kubernetes/kubelet-plugins/volume/exec/nodeagent~uds</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-kube-controllers.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See https://github.com/projectcalico/kube-controllers</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># The controllers can only have a single active instance.</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">scheduler.alpha.kubernetes.io/critical-pod:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="comment"># Mark the pod as a critical add-on for rescheduling.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CriticalAddonsOnly</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">calico/kube-controllers:v3.13.1</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Choose which controllers to run.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENABLED_CONTROLLERS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">node</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATASTORE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">kubernetes</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/usr/bin/check-status</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-r</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-etcd-secrets.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-typha.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/configure-canal.yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image088.png" alt="img"></p>
<h5 id="查看节点运行的情况"><a href="#查看节点运行的情况" class="headerlink" title="查看节点运行的情况"></a>查看节点运行的情况</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image089.png" alt="img"></p>
<h5 id="查看所有的pod的运行的情况"><a href="#查看所有的pod的运行的情况" class="headerlink" title="查看所有的pod的运行的情况"></a>查看所有的pod的运行的情况</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image090.png" alt="img"></p>
<p>这里需要注意的是，必须等所有的状态为Runing才能进行下一步操作。</p>
<h6 id="如果上面操作导致pod有报错："><a href="#如果上面操作导致pod有报错：" class="headerlink" title="如果上面操作导致pod有报错："></a>如果上面操作导致pod有报错：</h6><p>比如报</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: the server doesn&#x27;t have a resource type &quot;calico-kube-controllers-544658cf79-bv5mj&quot;</span><br></pre></td></tr></table></figure>

<p>这个异常</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image091.png" alt="img"></p>
<p>解决： 可以试下重启一下<code>kubelet</code>服务，然后等待一下，应该就可以了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<h5 id="执行令牌（在从节点操作）"><a href="#执行令牌（在从节点操作）" class="headerlink" title="执行令牌（在从节点操作）"></a>执行令牌（在从节点操作）</h5><p>这里注意的是，一定成初始化成功后面获取复制。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image092.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.142.138:6443 --token 8yvi2m.466nhemzvyqcxkny   --discovery-token-ca-cert-hash sha256:99a5fdcb4af4dd9c2ee40e48ba420d7630676a77a3c0f2445c260921fdcaf83a   </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果在两个从节点运行执行令牌报错：</span></span><br><span class="line">[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1 [preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...` To see the stack trace of this error execute with --v=5 or higher   </span><br><span class="line"></span><br><span class="line">解决方案，两个从节点都执行以下命令</span><br><span class="line">echo &quot;1&quot; &gt;/proc/sys/net/bridge/bridge-nf-call-iptables</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">如果超过2小时忘记了令牌，可以这样做</span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"><span class="meta">#</span><span class="bash">打印新令牌，<span class="comment">#创建个永不过期的令牌</span></span></span><br><span class="line">kubeadm token create --ttl 0 --print-join-command</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image093.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image094.png" alt="img"></p>
<p>加入令牌完成。</p>
<h5 id="在主节点查看节点运行的情况"><a href="#在主节点查看节点运行的情况" class="headerlink" title="在主节点查看节点运行的情况"></a>在主节点查看节点运行的情况</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image095.png" alt="img"></p>
<h5 id="查看所有的pod的运行的情况-1"><a href="#查看所有的pod的运行的情况-1" class="headerlink" title="查看所有的pod的运行的情况"></a>查看所有的pod的运行的情况</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image096.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image097.png" alt="img"></p>
<p>这里需要注意的是，必须等所有的状态为Runing才能进行下一步操作。</p>
<h3 id="搭建NFS作为默认sc（所有节点）"><a href="#搭建NFS作为默认sc（所有节点）" class="headerlink" title="搭建NFS作为默认sc（所有节点）"></a>搭建NFS作为默认sc（所有节点）</h3><h4 id="配置NFS服务器"><a href="#配置NFS服务器" class="headerlink" title="配置NFS服务器"></a>配置NFS服务器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils   echo &quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot; &gt; /etc/exports </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image098.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image099.png" alt="img"></p>
<h4 id="创建nfs服务器目录（主节点作为服务器，主节点操作）"><a href="#创建nfs服务器目录（主节点作为服务器，主节点操作）" class="headerlink" title="创建nfs服务器目录（主节点作为服务器，主节点操作）"></a>创建nfs服务器目录（主节点作为服务器，主节点操作）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /nfs/data </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image100.png" alt="img"></p>
<h4 id="启动nfs服务命令"><a href="#启动nfs服务命令" class="headerlink" title="启动nfs服务命令"></a>启动nfs服务命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image101.png" alt="img"></p>
<h4 id="检查配置是否生效"><a href="#检查配置是否生效" class="headerlink" title="检查配置是否生效"></a>检查配置是否生效</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exportfs</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image102.png" alt="img"></p>
<h4 id="测试Pod直接挂载NFS了（主节点操作）"><a href="#测试Pod直接挂载NFS了（主节点操作）" class="headerlink" title="测试Pod直接挂载NFS了（主节点操作）"></a>测试Pod直接挂载NFS了（主节点操作）</h4><h5 id="在opt目录下创建一个nginx-yaml的文件"><a href="#在opt目录下创建一个nginx-yaml的文件" class="headerlink" title="在opt目录下创建一个nginx.yaml的文件"></a>在opt目录下创建一个nginx.yaml的文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.yaml </span><br></pre></td></tr></table></figure>

<h5 id="写入以下的命令"><a href="#写入以下的命令" class="headerlink" title="写入以下的命令"></a>写入以下的命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: vol-nfs</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: html</span><br><span class="line">    nfs:</span><br><span class="line">      path: /nfs/data   #nfs服务器目录</span><br><span class="line">      server: 192.168.142.144 #自己的nfs服务器地址</span><br><span class="line">  containers:</span><br><span class="line">  - name: myapp</span><br><span class="line">    image: nginx</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: html</span><br><span class="line">      mountPath: /usr/share/nginx/html/</span><br></pre></td></tr></table></figure>

<p><strong>这里注意：server: 10.12.0.9 #自己的nfs服务器地址</strong></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image103.png" alt="img"></p>
<h5 id="应用该yaml的pod服务"><a href="#应用该yaml的pod服务" class="headerlink" title="应用该yaml的pod服务"></a>应用该yaml的pod服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image104.png" alt="img"></p>
<h5 id="检查该pod是否允许状态"><a href="#检查该pod是否允许状态" class="headerlink" title="检查该pod是否允许状态"></a>检查该pod是否允许状态</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image105.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image106.png" alt="img"></p>
<p><strong>这里需要注意的是，必须等所有的状态为Runing才能进行下一步操作。</strong></p>
<h5 id="查看nginx的pod的IP访问地址"><a href="#查看nginx的pod的IP访问地址" class="headerlink" title="查看nginx的pod的IP访问地址"></a>查看nginx的pod的IP访问地址</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -o wide </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image107.png" alt="img"></p>
<p>访问地址: 10.244.107.193</p>
<h5 id="本地测试访问pod信息"><a href="#本地测试访问pod信息" class="headerlink" title="本地测试访问pod信息"></a>本地测试访问pod信息</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.244.107.193</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image108.png" alt="img"></p>
<p>这里我们看到的是访问的页面是403，我们可以访问具体页面</p>
<p>我们需要在<code>/nfs/data/</code>下新建一个<code>index.html</code>文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /nfs/data/ vim index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image109.png" alt="img"></p>
<h5 id="再次测试访问pod信息"><a href="#再次测试访问pod信息" class="headerlink" title="再次测试访问pod信息"></a>再次测试访问pod信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.244.107.193</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image110.png" alt="img"></p>
<h3 id="搭建NFS-Client"><a href="#搭建NFS-Client" class="headerlink" title="搭建NFS-Client"></a>搭建NFS-Client</h3><p>服务器端防火墙开放111、662、875、892、2049的 tcp / udp 允许，否则远端客户无法连接。</p>
<h4 id="安装客户端工具（node节点操作）"><a href="#安装客户端工具（node节点操作）" class="headerlink" title="安装客户端工具（node节点操作）"></a>安装客户端工具（node节点操作）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.142.144</span><br></pre></td></tr></table></figure>

<p><strong>该IP地址是master的IP地址。</strong></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image111.png" alt="img"></p>
<h4 id="创建同步文件夹"><a href="#创建同步文件夹" class="headerlink" title="创建同步文件夹"></a>创建同步文件夹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/nfsmount ls /root</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image112.png" alt="img"></p>
<h4 id="将客户端的-root-nfsmount和-nfs-data-做同步（node节点操作）"><a href="#将客户端的-root-nfsmount和-nfs-data-做同步（node节点操作）" class="headerlink" title="将客户端的/root/nfsmount和/nfs/data/做同步（node节点操作）"></a>将客户端的<code>/root/nfsmount</code>和<code>/nfs/data/</code>做同步（<code>node</code>节点操作）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs 192.168.142.144:/nfs/data/ /root/nfsmount</span><br></pre></td></tr></table></figure>

<p><strong>10.12.0.9：是nfs的服务器的地址，这里是master的IP地址。</strong></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image113.png" alt="img"></p>
<h4 id="查看原来的文件信息（从）机器"><a href="#查看原来的文件信息（从）机器" class="headerlink" title="查看原来的文件信息（从）机器"></a>查看原来的文件信息（从）机器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image114.png" alt="img"></p>
<h4 id="修改原来的文件信息（主）机器"><a href="#修改原来的文件信息（主）机器" class="headerlink" title="修改原来的文件信息（主）机器"></a>修改原来的文件信息（主）机器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image115.png" alt="img"></p>
<h4 id="在另外的机器上查看效果"><a href="#在另外的机器上查看效果" class="headerlink" title="在另外的机器上查看效果"></a>在另外的机器上查看效果</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image115.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image116.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image117.png" alt="img"></p>
<h3 id="设置动态供应"><a href="#设置动态供应" class="headerlink" title="设置动态供应"></a>设置动态供应</h3><p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image118.png" alt="img"></p>
<h4 id="创建provisioner（NFS环境前面已经搭好）"><a href="#创建provisioner（NFS环境前面已经搭好）" class="headerlink" title="创建provisioner（NFS环境前面已经搭好）"></a>创建<code>provisioner</code>（NFS环境前面已经搭好）</h4><table>
<thead>
<tr>
<th>字段名称</th>
<th>填入内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>名称</td>
<td>nfs-storage</td>
<td>自定义存储类名称</td>
</tr>
<tr>
<td>NFS Server</td>
<td>192.168.142.147</td>
<td>NFS服务的IP地址</td>
</tr>
<tr>
<td>NFS Path</td>
<td>/nfs/data</td>
<td>NFS服务所共享的路径</td>
</tr>
</tbody></table>
<h5 id="先创建授权（master节点操作）"><a href="#先创建授权（master节点操作）" class="headerlink" title="先创建授权（master节点操作）"></a>先创建授权（master节点操作）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nfs-rbac.yaml</span><br></pre></td></tr></table></figure>

<p> 在opt目录下 </p>
<p>新建内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;services&quot;</span>, <span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>,<span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;podsecuritypolicies&quot;</span>]</span><br><span class="line">      <span class="attr">resourceNames:</span> [<span class="string">&quot;nfs-provisioner&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;use&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">   <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">   <span class="attr">strategy:</span></span><br><span class="line">     <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">   <span class="attr">selector:</span></span><br><span class="line">     <span class="attr">matchLabels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">   <span class="attr">template:</span></span><br><span class="line">      <span class="attr">metadata:</span></span><br><span class="line">         <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">         <span class="attr">serviceAccount:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">         <span class="attr">containers:</span></span><br><span class="line">            <span class="bullet">-</span>  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">               <span class="attr">image:</span> <span class="string">lizhenliang/nfs-client-provisioner</span></span><br><span class="line">               <span class="attr">volumeMounts:</span></span><br><span class="line">                 <span class="bullet">-</span>  <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">                    <span class="attr">mountPath:</span>  <span class="string">/persistentvolumes</span></span><br><span class="line">               <span class="attr">env:</span></span><br><span class="line">                 <span class="bullet">-</span>  <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">                    <span class="attr">value:</span> <span class="string">storage.pri/nfs</span></span><br><span class="line">                 <span class="bullet">-</span>  <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">                    <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.142</span><span class="number">.144</span> <span class="comment">#master地址</span></span><br><span class="line">                 <span class="bullet">-</span>  <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">                    <span class="attr">value:</span> <span class="string">/nfs/data</span></span><br><span class="line">         <span class="attr">volumes:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">             <span class="attr">nfs:</span></span><br><span class="line">               <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.142</span><span class="number">.144</span> <span class="comment">#master地址</span></span><br><span class="line">               <span class="attr">path:</span> <span class="string">/nfs/data</span> <span class="comment">#nfs服务器目录</span></span><br></pre></td></tr></table></figure>

<p><strong>这个镜像中<code>volume的mountPath</code>默认为<code>/persistentvolumes</code>，不能修改，否则运行时会报错。红色的必须是自己的master的IP地址。</strong></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image119.png" alt="img"></p>
<h5 id="执行创建nfs的yaml文件信息"><a href="#执行创建nfs的yaml文件信息" class="headerlink" title="执行创建nfs的yaml文件信息"></a>执行创建nfs的yaml文件信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-rbac.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image120.png" alt="img"></p>
<h5 id="如果发现pod有问题，想删除pod进行重新kubectl-apply-f-nfs-rbac-yaml的话，可以参照这个博客文档："><a href="#如果发现pod有问题，想删除pod进行重新kubectl-apply-f-nfs-rbac-yaml的话，可以参照这个博客文档：" class="headerlink" title="如果发现pod有问题，想删除pod进行重新kubectl apply-f nfs-rbac.yaml的话，可以参照这个博客文档："></a>如果发现pod有问题，想删除pod进行重新kubectl apply-f nfs-rbac.yaml的话，可以参照这个博客文档：</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43542988/article/details/101277263?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param">https://blog.csdn.net/qq_43542988/article/details/101277263?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param</a></p>
<h5 id="查看pod的状态信息"><a href="#查看pod的状态信息" class="headerlink" title="查看pod的状态信息"></a>查看pod的状态信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>

<p>  如果报错：查看报错信息，这个命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod xxx -n kube-system </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image121.png" alt="img"></p>
<h5 id="创建storageclass（master节点操作）"><a href="#创建storageclass（master节点操作）" class="headerlink" title="创建storageclass（master节点操作）"></a>创建storageclass（master节点操作）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim storageclass-nfs.yam</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">storage-nfs</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">storage.pri/nfs</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Delete</span></span><br></pre></td></tr></table></figure>

<h5 id="应用storageclass-nfs-yaml文件"><a href="#应用storageclass-nfs-yaml文件" class="headerlink" title="应用storageclass-nfs.yaml文件"></a>应用storageclass-nfs.yaml文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f storageclass-nfs.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image122.png" alt="img"></p>
<h5 id="修改默认的驱动"><a href="#修改默认的驱动" class="headerlink" title="修改默认的驱动"></a>修改默认的驱动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch storageclass storage-nfs -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27; </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image123.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get sc </span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image124.png" alt="img"></p>
<h3 id="安装metrics-server"><a href="#安装metrics-server" class="headerlink" title="安装metrics-server"></a>安装<code>metrics-server</code></h3><h4 id="准备metrics-server-yaml文件（主节点操作）"><a href="#准备metrics-server-yaml文件（主节点操作）" class="headerlink" title="准备metrics-server.yaml文件（主节点操作）"></a>准备<code>metrics-server.yaml</code>文件（主节点操作）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim metrics-server.yaml</span><br></pre></td></tr></table></figure>

<h4 id="编写以下的内容"><a href="#编写以下的内容" class="headerlink" title="编写以下的内容"></a>编写以下的内容</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:aggregated-metrics-reader</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;metrics.k8s.io&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>, <span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server:system:auth-delegator</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:auth-delegator</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server-auth-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">extension-apiserver-authentication-reader</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiregistration.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">APIService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">v1beta1.metrics.k8s.io</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">metrics.k8s.io</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1beta1</span></span><br><span class="line">  <span class="attr">insecureSkipTLSVerify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">groupPriorityMinimum:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">versionPriority:</span> <span class="number">100</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">metrics-server</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="comment"># mount in tmp so we can safely use from-scratch images and/or read-only containers</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-dir</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mirrorgooglecontainers/metrics-server-amd64:v0.3.6</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--cert-dir=/tmp</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--secure-port=4443</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--kubelet-insecure-tls</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">main-port</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">4443</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-dir</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">        <span class="attr">kubernetes.io/arch:</span> <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">kubernetes.io/name:</span> <span class="string">&quot;Metrics-server&quot;</span></span><br><span class="line">    <span class="attr">kubernetes.io/cluster-service:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">main-port</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/stats</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure>

<h4 id="应用该文件pod"><a href="#应用该文件pod" class="headerlink" title="应用该文件pod"></a>应用该文件pod</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f metrics-server.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image126.png" alt="img"></p>
<h4 id="查看部署的应用信息状态"><a href="#查看部署的应用信息状态" class="headerlink" title="查看部署的应用信息状态"></a>查看部署的应用信息状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image127.png" alt="img"></p>
<h4 id="查看系统的监控状态"><a href="#查看系统的监控状态" class="headerlink" title="查看系统的监控状态"></a>查看系统的监控状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl top nodes</span><br></pre></td></tr></table></figure>

<p> 如果运行<code>kubectl top nodes</code>这个命令，报<code>metrics not available yet</code> 这个命令还没有用，那就稍等一会，就能用了 </p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image128.png" alt="img"></p>
<p><strong>这里，kubesphere3.0的前置环境全部结束，把虚拟机做好快照。</strong></p>
<h2 id="安装kubesphere-v3-0-0"><a href="#安装kubesphere-v3-0-0" class="headerlink" title="安装kubesphere v3.0.0"></a>安装kubesphere v3.0.0</h2><h3 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h3><p><a target="_blank" rel="noopener" href="https://kubesphere.com.cn/">https://kubesphere.com.cn/</a></p>
<h3 id="部署文档地址"><a href="#部署文档地址" class="headerlink" title="部署文档地址"></a>部署文档地址</h3><p><a target="_blank" rel="noopener" href="https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/">https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/</a></p>
<h3 id="安装步骤说明（master节点）"><a href="#安装步骤说明（master节点）" class="headerlink" title="安装步骤说明（master节点）"></a>安装步骤说明（master节点）</h3><h4 id="安装集群配置文件"><a href="#安装集群配置文件" class="headerlink" title="安装集群配置文件"></a>安装集群配置文件</h4><h5 id="准备配置文件cluster-configuration-yaml"><a href="#准备配置文件cluster-configuration-yaml" class="headerlink" title="准备配置文件cluster-configuration.yaml "></a>准备配置文件<code>cluster-configuration.yaml </code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim cluster-configuration.yaml</span><br></pre></td></tr></table></figure>

<h5 id="编写以下的内容配置"><a href="#编写以下的内容配置" class="headerlink" title="编写以下的内容配置"></a>编写以下的内容配置</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">installer.kubesphere.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v3.0.0</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">persistence:</span></span><br><span class="line">    <span class="attr">storageClass:</span> <span class="string">&quot;&quot;</span>        <span class="comment"># If there is not a default StorageClass in your cluster, you need to specify an existing StorageClass here.</span></span><br><span class="line">  <span class="attr">authentication:</span></span><br><span class="line">    <span class="attr">jwtSecret:</span> <span class="string">&quot;&quot;</span>           <span class="comment"># Keep the jwtSecret consistent with the host cluster. Retrive the jwtSecret by executing &quot;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &quot;apiVersion&quot; | grep jwtSecret&quot; on the host cluster.</span></span><br><span class="line">  <span class="attr">etcd:</span></span><br><span class="line">    <span class="attr">monitoring:</span> <span class="literal">true</span>       <span class="comment"># Whether to enable etcd monitoring dashboard installation. You have to create a secret for etcd before you enable it.</span></span><br><span class="line">    <span class="attr">endpointIps:</span> <span class="number">10.12</span><span class="number">.0</span><span class="number">.9</span>  <span class="comment"># etcd cluster EndpointIps, it can be a bunch of IPs here.</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">2379</span>              <span class="comment"># etcd port</span></span><br><span class="line">    <span class="attr">tlsEnable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">mysqlVolumeSize:</span> <span class="string">20Gi</span> <span class="comment"># MySQL PVC size.</span></span><br><span class="line">    <span class="attr">minioVolumeSize:</span> <span class="string">20Gi</span> <span class="comment"># Minio PVC size.</span></span><br><span class="line">    <span class="attr">etcdVolumeSize:</span> <span class="string">20Gi</span>  <span class="comment"># etcd PVC size.</span></span><br><span class="line">    <span class="attr">openldapVolumeSize:</span> <span class="string">2Gi</span>   <span class="comment"># openldap PVC size.</span></span><br><span class="line">    <span class="attr">redisVolumSize:</span> <span class="string">2Gi</span> <span class="comment"># Redis PVC size.</span></span><br><span class="line">    <span class="attr">es:</span>   <span class="comment"># Storage backend for logging, events and auditing.</span></span><br><span class="line">      <span class="comment"># elasticsearchMasterReplicas: 1   # total number of master nodes, it&#x27;s not allowed to use even number</span></span><br><span class="line">      <span class="comment"># elasticsearchDataReplicas: 1     # total number of data nodes.</span></span><br><span class="line">      <span class="attr">elasticsearchMasterVolumeSize:</span> <span class="string">4Gi</span>   <span class="comment"># Volume size of Elasticsearch master nodes.</span></span><br><span class="line">      <span class="attr">elasticsearchDataVolumeSize:</span> <span class="string">20Gi</span>    <span class="comment"># Volume size of Elasticsearch data nodes.</span></span><br><span class="line">      <span class="attr">logMaxAge:</span> <span class="number">7</span>                     <span class="comment"># Log retention time in built-in Elasticsearch, it is 7 days by default.</span></span><br><span class="line">      <span class="attr">elkPrefix:</span> <span class="string">logstash</span>              <span class="comment"># The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span></span><br><span class="line">  <span class="attr">console:</span></span><br><span class="line">    <span class="attr">enableMultiLogin:</span> <span class="literal">true</span>  <span class="comment"># enable/disable multiple sing on, it allows an account can be used by different users at the same time.</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">30880</span></span><br><span class="line">  <span class="attr">alerting:</span>                <span class="comment"># (CPU: 0.3 Core, Memory: 300 MiB) Whether to install KubeSphere alerting system. It enables Users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auditing:</span>                <span class="comment"># Whether to install KubeSphere audit log system. It provides a security-relevant chronological set of records，recording the sequence of activities happened in platform, initiated by different tenants.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">devops:</span>                  <span class="comment"># (CPU: 0.47 Core, Memory: 8.6 G) Whether to install KubeSphere DevOps System. It provides out-of-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">jenkinsMemoryLim:</span> <span class="string">2Gi</span>      <span class="comment"># Jenkins memory limit.</span></span><br><span class="line">    <span class="attr">jenkinsMemoryReq:</span> <span class="string">1500Mi</span>   <span class="comment"># Jenkins memory request.</span></span><br><span class="line">    <span class="attr">jenkinsVolumeSize:</span> <span class="string">8Gi</span>     <span class="comment"># Jenkins volume size.</span></span><br><span class="line">    <span class="attr">jenkinsJavaOpts_Xms:</span> <span class="string">512m</span>  <span class="comment"># The following three fields are JVM parameters.</span></span><br><span class="line">    <span class="attr">jenkinsJavaOpts_Xmx:</span> <span class="string">512m</span></span><br><span class="line">    <span class="attr">jenkinsJavaOpts_MaxRAM:</span> <span class="string">2g</span></span><br><span class="line">  <span class="attr">events:</span>                  <span class="comment"># Whether to install KubeSphere events system. It provides a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">ruler:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">logging:</span>                 <span class="comment"># (CPU: 57 m, Memory: 2.76 G) Whether to install KubeSphere logging system. Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">logsidecarReplicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">metrics_server:</span>                    <span class="comment"># (CPU: 56 m, Memory: 44.35 MiB) Whether to install metrics-server. IT enables HPA (Horizontal Pod Autoscaler).</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">monitoring:</span></span><br><span class="line">    <span class="comment"># prometheusReplicas: 1            # Prometheus replicas are responsible for monitoring different segments of data source and provide high availability as well.</span></span><br><span class="line">    <span class="attr">prometheusMemoryRequest:</span> <span class="string">400Mi</span>   <span class="comment"># Prometheus request memory.</span></span><br><span class="line">    <span class="attr">prometheusVolumeSize:</span> <span class="string">20Gi</span>       <span class="comment"># Prometheus PVC size.</span></span><br><span class="line">    <span class="comment"># alertmanagerReplicas: 1          # AlertManager Replicas.</span></span><br><span class="line">  <span class="attr">multicluster:</span></span><br><span class="line">    <span class="attr">clusterRole:</span> <span class="string">none</span>  <span class="comment"># host | member | none  # You can install a solo cluster, or specify it as the role of host or member cluster.</span></span><br><span class="line">  <span class="attr">networkpolicy:</span>       <span class="comment"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span></span><br><span class="line">    <span class="comment"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">notification:</span>        <span class="comment"># Email Notification support for the legacy alerting system, should be enabled/disabled together with the above alerting option.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">openpitrix:</span>          <span class="comment"># (2 Core, 3.6 G) Whether to install KubeSphere Application Store. It provides an application store for Helm-based applications, and offer application lifecycle management.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">servicemesh:</span>         <span class="comment"># (0.3 Core, 300 MiB) Whether to install KubeSphere Service Mesh (Istio-based). It provides fine-grained traffic management, observability and tracing, and offer visualization for traffic topology.</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><strong>endpointIps: 10.12.0.9：master节点的地址。</strong></p>
<h5 id="准备配置文件kubesphere-installer-yaml文件"><a href="#准备配置文件kubesphere-installer-yaml文件" class="headerlink" title="准备配置文件kubesphere-installer.yaml文件"></a>准备配置文件<code>kubesphere-installer.yaml</code>文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim kubesphere-installer.yaml</span><br></pre></td></tr></table></figure>

<h5 id="编写以下的内容配置-1"><a href="#编写以下的内容配置-1" class="headerlink" title="编写以下的内容配置"></a>编写以下的内容配置</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">clusterconfigurations.installer.kubesphere.io</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">installer.kubesphere.io</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1alpha1</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">clusterconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">clusterconfiguration</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubesphere-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">apps</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">batch</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">apiregistration.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">apiextensions.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tenant.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">certificates.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">devops.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">monitoring.coreos.com</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">logging.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jaegertracing.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">storage.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">admissionregistration.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">policy</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">autoscaling</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.istio.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">config.istio.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">iam.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">notification.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">auditing.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">events.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">core.kubefed.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">installer.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">storage.kubesphere.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-installer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ks-install</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ks-install</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ks-install</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">ks-installer</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">installer</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">kubesphere/ks-installer:v3.0.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">host-time</span></span><br></pre></td></tr></table></figure>

<h5 id="分别应用两个文件"><a href="#分别应用两个文件" class="headerlink" title="分别应用两个文件"></a>分别应用两个文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kubesphere-installer.yaml</span><br><span class="line">kubectl apply -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image131.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image132.png" alt="img"></p>
<h5 id="监控安装的日志信息"><a href="#监控安装的日志信息" class="headerlink" title="监控安装的日志信息"></a>监控安装的日志信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image133.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image134.png" alt="img"></p>
<h5 id="查看pod启动状态信息"><a href="#查看pod启动状态信息" class="headerlink" title="查看pod启动状态信息"></a>查看pod启动状态信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image135.png" alt="img"></p>
<p>需要等待漫长的时间。喝杯茶，抽支烟。</p>
<h3 id="访问验证是否安装成功"><a href="#访问验证是否安装成功" class="headerlink" title="访问验证是否安装成功"></a>访问验证是否安装成功</h3><p>访问地址：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.142.141:30880/login">http://192.168.142.141:30880/login</a></p>
<p>帐号：admin</p>
<p>密码：P@88w0rd</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image136.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image137.png" alt="img"></p>
<h4 id="解决prometheus一直没能Running的问题，缺少证书"><a href="#解决prometheus一直没能Running的问题，缺少证书" class="headerlink" title="解决prometheus一直没能Running的问题，缺少证书"></a>解决<code>prometheus</code>一直没能<code>Running</code>的问题，缺少证书</h4><p>如等待了半个小时左右还是没能<code>Running</code>，特别是<code>monitoring</code>这两个有问题，这个是监控用的</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image138.png" alt="img"></p>
<p>那么说明出现问题了，我们来查看一下 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod prometheus-k8s-0 -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image139.png" alt="img"></p>
<p>说没有这个<code>secret-kube-etcd-client-certs</code>这个证书</p>
<p>看一下<code>kubesphere</code>的整个<code>apiserver</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep kube-apiserver</span><br></pre></td></tr></table></figure>

<p>这个<code>apiserver</code>就会打印整个证书位置</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image140.png" alt="img"></p>
<p>说明是有这些证书文件的，但是<code>kubesphere</code>它不知道，它相当于依赖了我们系统里面的</p>
<p>这些证书文件就是在这些位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt </span><br><span class="line">--etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt </span><br><span class="line">--etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key</span><br></pre></td></tr></table></figure>

<p><strong>解决方案：把这个命令复制到主节点运行即可</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubesphere-monitoring-system create secret generic kube-etcd-client-certs --from-file=etcd-client-ca.crt=/etc/kubernetes/pki/etcd/ca.crt --from-file=etcd-client.crt=/etc/kubernetes/pki/apiserver-etcd-client.crt --from-file=etcd-client.key=/etc/kubernetes/pki/apiserver-etcd-client.key</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image141.png" alt="img"></p>
<p>表示这个<code>secret</code>已经创建了</p>
<p>可以用命令查看是否创建成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这个命令的意思就是获取所有系统里面的secret</span></span><br><span class="line">kubectl get secret -A</span><br></pre></td></tr></table></figure>

<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image142.png" alt="img"></p>
<p>只要证书一创建，那么我们这个<code>prometheus</code>很快就可以了</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image143.png" alt="img"></p>
<p>如果还是不行，把这个<code>prometheus-k8s-0</code>这个<code>pod</code>删掉，删除命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod prometheus-k8s-0 -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure>

<p>然后让它再拉取一个就可以了，再把 <code>prometheus-k8s-1</code>这个<code>pod</code>删掉，也让它重新拉取，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod prometheus-k8s-1 -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure>

<p>那么此时，我们可以看到<code>kubesphere</code>的全部已经搞好了，监控也正常了。</p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image144.png" alt="img"></p>
<p><img src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image145.png" alt="img"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Gu you</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://guyou1024.com/2023/02/24/kubesphere3.0%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/">http://guyou1024.com/2023/02/24/kubesphere3.0%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://guyou1024.com" target="_blank">故友的学习录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a></div><div class="post_share"><div class="social-share" data-image="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image000.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/wechat.png" target="_blank"><img class="post-qr-code-img" src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/alipay.png" target="_blank"><img class="post-qr-code-img" src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/01/30/Docker%E6%90%AD%E5%BB%BA%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%9B%86%E7%BE%A4/"><img class="next-cover" src="https://guyou-blog.oss-cn-shenzhen.aliyuncs.com/static/image-20230131171638825.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Docker搭建常用中间件集群</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#kubesphere3-0%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">kubesphere3.0的安装文档</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">系统要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.</span> <span class="toc-text">虚拟机安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E5%90%91%E5%AF%BC"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建客户机的向导</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">创建新的虚拟机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%91%E5%AF%BC"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">新建虚拟机向导</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">安装客户机的操作系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">选择客户机的操作系统类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E5%AE%A2%E6%88%B7%E6%9C%BA%E5%92%8C%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">命名客户机和存储位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E7%A3%81%E7%9B%98%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">配置客户机的磁盘的大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%B2%E7%BB%8F%E5%87%86%E5%A4%87%E5%88%9B%E5%BB%BA%E5%A5%BD%E7%9A%84%E5%AE%A2%E6%88%B7%E6%9C%BA"><span class="toc-number">2.2.1.7.</span> <span class="toc-text">已经准备创建好的客户机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.1.8.</span> <span class="toc-text">配置客户机的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%85%8D%E7%BD%AE%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.2.1.8.1.</span> <span class="toc-text">内存配置大小</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.2.</span> <span class="toc-text">处理器配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E7%9B%98%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.3.</span> <span class="toc-text">硬盘配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CD-DVD%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.4.</span> <span class="toc-text">CD&#x2F;DVD配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.5.</span> <span class="toc-text">网络适配器配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#USB%E6%8E%A7%E5%88%B6%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.6.</span> <span class="toc-text">USB控制器配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A3%B0%E5%8D%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.7.</span> <span class="toc-text">声卡配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.8.</span> <span class="toc-text">打印机配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.8.9.</span> <span class="toc-text">显示器配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.1.9.</span> <span class="toc-text">安装客户机的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.1.9.1.</span> <span class="toc-text">开始安装客户机系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%89%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.1.9.2.</span> <span class="toc-text">按下回车开始安装配置虚拟机安装属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%AF%AD%E8%A8%80"><span class="toc-number">2.2.1.9.3.</span> <span class="toc-text">选择客户机的系统语言</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.9.4.</span> <span class="toc-text">设置安装客户机的基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%80%89%E6%8B%A9%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.1.9.4.1.</span> <span class="toc-text">安装选择类型</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%B3%BB%E7%BB%9F-1"><span class="toc-number">2.2.1.9.5.</span> <span class="toc-text">开始安装客户机系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.1.9.6.</span> <span class="toc-text">用户设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F%E8%BF%9B%E8%A1%8C%E4%B8%AD"><span class="toc-number">2.2.1.9.7.</span> <span class="toc-text">安装系统进行中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.1.9.8.</span> <span class="toc-text">初始化客户机的步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%A5%E5%8F%97%E8%AE%B8%E5%8F%AF%E8%AF%81"><span class="toc-number">2.2.1.9.9.</span> <span class="toc-text">接受许可证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%AC%A2%E8%BF%8E%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.2.1.9.10.</span> <span class="toc-text">系统欢迎页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5%E6%B3%95"><span class="toc-number">2.2.1.9.11.</span> <span class="toc-text">自定义键盘输入法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.1.9.12.</span> <span class="toc-text">隐私设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E7%99%BB%E5%BD%95%E8%B4%A6%E5%8F%B7"><span class="toc-number">2.2.1.9.13.</span> <span class="toc-text">在线登录账号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.1.9.14.</span> <span class="toc-text">开始使用系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BB%88%E7%AB%AF%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9F%A5%E8%AF%A2IP%E5%9C%B0%E5%9D%80"><span class="toc-number">2.2.1.9.15.</span> <span class="toc-text">打开终端输入命令行查询IP地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89ip%E6%98%BE%E7%A4%BA%EF%BC%9A"><span class="toc-number">2.2.1.9.16.</span> <span class="toc-text">注意，如果没有ip显示：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.2.1.9.17.</span> <span class="toc-text">使用外部客户端工具连接</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%8E%AF%E5%A2%83%E5%A6%82%E4%B8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">虚拟机环境如下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4%E8%AF%B4%E6%98%8E"><span class="toc-number">2.4.</span> <span class="toc-text">前置步骤说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7"><span class="toc-number">2.4.1.</span> <span class="toc-text">安装基础工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEhosts%E7%9A%84%E5%9C%B0%E5%9D%80%E5%90%8D%E7%A7%B0"><span class="toc-number">2.4.2.</span> <span class="toc-text">配置hosts的地址名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E6%88%96%E8%80%85%E9%98%BF%E9%87%8C%E4%BA%91%E5%BC%80%E9%80%9A%E5%AE%89%E5%85%A8%E7%BB%84%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE"><span class="toc-number">2.4.3.</span> <span class="toc-text">关闭防火墙或者阿里云开通安全组端口访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD-selinux"><span class="toc-number">2.4.4.</span> <span class="toc-text">关闭 selinux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD-swap"><span class="toc-number">2.4.5.</span> <span class="toc-text">关闭 swap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%A1%A5%E6%8E%A5%E7%9A%84-IPv4-%E6%B5%81%E9%87%8F%E4%BC%A0%E9%80%92%E5%88%B0-iptables-%E7%9A%84%E9%93%BE"><span class="toc-number">2.4.6.</span> <span class="toc-text">将桥接的 IPv4 流量传递到 iptables 的链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89-etc-sysctl-conf%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%9D%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C"><span class="toc-number">2.4.6.1.</span> <span class="toc-text">如果没有&#x2F;etc&#x2F;sysctl.conf文件的话直接执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%9C%89%E8%AF%A5%E6%96%87%E4%BB%B6%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.6.2.</span> <span class="toc-text">如果有该文件可以执行以下命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E4%BB%A5%E5%BA%94%E7%94%A8"><span class="toc-number">2.4.6.3.</span> <span class="toc-text">执行命令以应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E7%8E%AF%E5%A2%83%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.4.7.</span> <span class="toc-text">安装Docker环境（所有节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC%E7%9A%84docker"><span class="toc-number">2.4.7.1.</span> <span class="toc-text">卸载旧版本的docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E4%BE%9D%E8%B5%96"><span class="toc-number">2.4.7.2.</span> <span class="toc-text">安装基础依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEdocker-yum%E6%BA%90"><span class="toc-number">2.4.7.3.</span> <span class="toc-text">配置docker yum源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8-docker"><span class="toc-number">2.4.7.4.</span> <span class="toc-text">安装并启动 docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEdocker%E5%8A%A0%E9%80%9F"><span class="toc-number">2.4.7.5.</span> <span class="toc-text">配置docker加速</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdocker%E5%8A%A0%E9%80%9F%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">2.4.7.5.1.</span> <span class="toc-text">创建docker加速文件夹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%98%BF%E9%87%8C%E4%BA%91%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">2.4.7.5.2.</span> <span class="toc-text">登录阿里云获取镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85k8s%E7%8E%AF%E5%A2%83"><span class="toc-number">2.4.8.</span> <span class="toc-text">安装k8s环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85k8s%E3%80%81kubelet%E3%80%81kubeadm%E3%80%81kubectl%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.4.8.1.</span> <span class="toc-text">安装k8s、kubelet、kubeadm、kubectl（所有节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEK8S%E7%9A%84yum%E6%BA%90"><span class="toc-number">2.4.8.1.1.</span> <span class="toc-text">配置K8S的yum源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC"><span class="toc-number">2.4.8.1.2.</span> <span class="toc-text">卸载旧版本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubelet%E3%80%81kubeadm%E3%80%81kubectl"><span class="toc-number">2.4.8.1.3.</span> <span class="toc-text">安装kubelet、kubeadm、kubectl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E5%92%8C%E9%87%8D%E5%90%AFkubelet"><span class="toc-number">2.4.8.1.4.</span> <span class="toc-text">开机启动和重启kubelet</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9"><span class="toc-number">2.4.8.2.</span> <span class="toc-text">初始化所有节点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAshell%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B"><span class="toc-number">2.4.8.2.1.</span> <span class="toc-text">创建一个shell脚本内容如下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%86%E8%AF%A5%E8%84%9A%E6%9C%AC%E6%8E%88%E4%BA%88%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">2.4.8.2.2.</span> <span class="toc-text">将该脚本授予可执行的权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AF%A5%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.8.2.3.</span> <span class="toc-text">执行该脚本命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96master%E8%8A%82%E7%82%B9"><span class="toc-number">2.4.8.2.4.</span> <span class="toc-text">初始化master节点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8A%E5%86%85%E5%AE%B9%E6%8A%A5%E9%94%99%EF%BC%9A"><span class="toc-number">2.4.8.2.4.1.</span> <span class="toc-text">如果输入以上内容报错：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-kubectl"><span class="toc-number">2.4.8.2.5.</span> <span class="toc-text">配置 kubectl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="toc-number">2.4.8.2.6.</span> <span class="toc-text">部署网络插件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E8%BF%90%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">2.4.8.2.7.</span> <span class="toc-text">查看节点运行的情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84pod%E7%9A%84%E8%BF%90%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">2.4.8.2.8.</span> <span class="toc-text">查看所有的pod的运行的情况</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E4%B8%8A%E9%9D%A2%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4pod%E6%9C%89%E6%8A%A5%E9%94%99%EF%BC%9A"><span class="toc-number">2.4.8.2.8.1.</span> <span class="toc-text">如果上面操作导致pod有报错：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%A4%E7%89%8C%EF%BC%88%E5%9C%A8%E4%BB%8E%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.8.2.9.</span> <span class="toc-text">执行令牌（在从节点操作）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E4%B8%BB%E8%8A%82%E7%82%B9%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E8%BF%90%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">2.4.8.2.10.</span> <span class="toc-text">在主节点查看节点运行的情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84pod%E7%9A%84%E8%BF%90%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5-1"><span class="toc-number">2.4.8.2.11.</span> <span class="toc-text">查看所有的pod的运行的情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BANFS%E4%BD%9C%E4%B8%BA%E9%BB%98%E8%AE%A4sc%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.4.9.</span> <span class="toc-text">搭建NFS作为默认sc（所有节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AENFS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.4.9.1.</span> <span class="toc-text">配置NFS服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAnfs%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%AE%E5%BD%95%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%B8%BB%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.9.2.</span> <span class="toc-text">创建nfs服务器目录（主节点作为服务器，主节点操作）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8nfs%E6%9C%8D%E5%8A%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.9.3.</span> <span class="toc-text">启动nfs服务命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E7%94%9F%E6%95%88"><span class="toc-number">2.4.9.4.</span> <span class="toc-text">检查配置是否生效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95Pod%E7%9B%B4%E6%8E%A5%E6%8C%82%E8%BD%BDNFS%E4%BA%86%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.9.5.</span> <span class="toc-text">测试Pod直接挂载NFS了（主节点操作）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8opt%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAnginx-yaml%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.9.5.1.</span> <span class="toc-text">在opt目录下创建一个nginx.yaml的文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E4%BB%A5%E4%B8%8B%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.9.5.2.</span> <span class="toc-text">写入以下的命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E8%AF%A5yaml%E7%9A%84pod%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.4.9.5.3.</span> <span class="toc-text">应用该yaml的pod服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%AF%A5pod%E6%98%AF%E5%90%A6%E5%85%81%E8%AE%B8%E7%8A%B6%E6%80%81"><span class="toc-number">2.4.9.5.4.</span> <span class="toc-text">检查该pod是否允许状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bnginx%E7%9A%84pod%E7%9A%84IP%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80"><span class="toc-number">2.4.9.5.5.</span> <span class="toc-text">查看nginx的pod的IP访问地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AEpod%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.9.5.6.</span> <span class="toc-text">本地测试访问pod信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AEpod%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.9.5.7.</span> <span class="toc-text">再次测试访问pod信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BANFS-Client"><span class="toc-number">2.4.10.</span> <span class="toc-text">搭建NFS-Client</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%EF%BC%88node%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.10.1.</span> <span class="toc-text">安装客户端工具（node节点操作）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%8C%E6%AD%A5%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">2.4.10.2.</span> <span class="toc-text">创建同步文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-root-nfsmount%E5%92%8C-nfs-data-%E5%81%9A%E5%90%8C%E6%AD%A5%EF%BC%88node%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.10.3.</span> <span class="toc-text">将客户端的&#x2F;root&#x2F;nfsmount和&#x2F;nfs&#x2F;data&#x2F;做同步（node节点操作）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8E%9F%E6%9D%A5%E7%9A%84%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%EF%BC%88%E4%BB%8E%EF%BC%89%E6%9C%BA%E5%99%A8"><span class="toc-number">2.4.10.4.</span> <span class="toc-text">查看原来的文件信息（从）机器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8E%9F%E6%9D%A5%E7%9A%84%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%EF%BC%88%E4%B8%BB%EF%BC%89%E6%9C%BA%E5%99%A8"><span class="toc-number">2.4.10.5.</span> <span class="toc-text">修改原来的文件信息（主）机器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%8F%A6%E5%A4%96%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%E6%9F%A5%E7%9C%8B%E6%95%88%E6%9E%9C"><span class="toc-number">2.4.10.6.</span> <span class="toc-text">在另外的机器上查看效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%8A%A8%E6%80%81%E4%BE%9B%E5%BA%94"><span class="toc-number">2.4.11.</span> <span class="toc-text">设置动态供应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAprovisioner%EF%BC%88NFS%E7%8E%AF%E5%A2%83%E5%89%8D%E9%9D%A2%E5%B7%B2%E7%BB%8F%E6%90%AD%E5%A5%BD%EF%BC%89"><span class="toc-number">2.4.11.1.</span> <span class="toc-text">创建provisioner（NFS环境前面已经搭好）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%88%E5%88%9B%E5%BB%BA%E6%8E%88%E6%9D%83%EF%BC%88master%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.11.1.1.</span> <span class="toc-text">先创建授权（master节点操作）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%88%9B%E5%BB%BAnfs%E7%9A%84yaml%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.11.1.2.</span> <span class="toc-text">执行创建nfs的yaml文件信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%8F%91%E7%8E%B0pod%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E6%83%B3%E5%88%A0%E9%99%A4pod%E8%BF%9B%E8%A1%8C%E9%87%8D%E6%96%B0kubectl-apply-f-nfs-rbac-yaml%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%82%E7%85%A7%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3%EF%BC%9A"><span class="toc-number">2.4.11.1.3.</span> <span class="toc-text">如果发现pod有问题，想删除pod进行重新kubectl apply-f nfs-rbac.yaml的话，可以参照这个博客文档：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bpod%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.11.1.4.</span> <span class="toc-text">查看pod的状态信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAstorageclass%EF%BC%88master%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.11.1.5.</span> <span class="toc-text">创建storageclass（master节点操作）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8storageclass-nfs-yaml%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.11.1.6.</span> <span class="toc-text">应用storageclass-nfs.yaml文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%9A%84%E9%A9%B1%E5%8A%A8"><span class="toc-number">2.4.11.1.7.</span> <span class="toc-text">修改默认的驱动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85metrics-server"><span class="toc-number">2.4.12.</span> <span class="toc-text">安装metrics-server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87metrics-server-yaml%E6%96%87%E4%BB%B6%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.4.12.1.</span> <span class="toc-text">准备metrics-server.yaml文件（主节点操作）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A5%E4%B8%8B%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">2.4.12.2.</span> <span class="toc-text">编写以下的内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E8%AF%A5%E6%96%87%E4%BB%B6pod"><span class="toc-number">2.4.12.3.</span> <span class="toc-text">应用该文件pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%83%A8%E7%BD%B2%E7%9A%84%E5%BA%94%E7%94%A8%E4%BF%A1%E6%81%AF%E7%8A%B6%E6%80%81"><span class="toc-number">2.4.12.4.</span> <span class="toc-text">查看部署的应用信息状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81"><span class="toc-number">2.4.12.5.</span> <span class="toc-text">查看系统的监控状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubesphere-v3-0-0"><span class="toc-number">2.5.</span> <span class="toc-text">安装kubesphere v3.0.0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80"><span class="toc-number">2.5.1.</span> <span class="toc-text">文档地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80"><span class="toc-number">2.5.2.</span> <span class="toc-text">部署文档地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4%E8%AF%B4%E6%98%8E%EF%BC%88master%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.5.3.</span> <span class="toc-text">安装步骤说明（master节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">安装集群配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6cluster-configuration-yaml"><span class="toc-number">2.5.3.1.1.</span> <span class="toc-text">准备配置文件cluster-configuration.yaml </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A5%E4%B8%8B%E7%9A%84%E5%86%85%E5%AE%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.3.1.2.</span> <span class="toc-text">编写以下的内容配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6kubesphere-installer-yaml%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.3.1.3.</span> <span class="toc-text">准备配置文件kubesphere-installer.yaml文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A5%E4%B8%8B%E7%9A%84%E5%86%85%E5%AE%B9%E9%85%8D%E7%BD%AE-1"><span class="toc-number">2.5.3.1.4.</span> <span class="toc-text">编写以下的内容配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E5%BA%94%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.3.1.5.</span> <span class="toc-text">分别应用两个文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E5%AE%89%E8%A3%85%E7%9A%84%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="toc-number">2.5.3.1.6.</span> <span class="toc-text">监控安装的日志信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bpod%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">2.5.3.1.7.</span> <span class="toc-text">查看pod启动状态信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="toc-number">2.5.4.</span> <span class="toc-text">访问验证是否安装成功</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3prometheus%E4%B8%80%E7%9B%B4%E6%B2%A1%E8%83%BDRunning%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E7%BC%BA%E5%B0%91%E8%AF%81%E4%B9%A6"><span class="toc-number">2.5.4.1.</span> <span class="toc-text">解决prometheus一直没能Running的问题，缺少证书</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By Gu you</div></div><!--  if theme.footer.copyright--><!--    .framework-info--><!--      span= _p('footer.framework') + ' '--><!--      a(href='https://hexo.io')= 'Hexo'--><!--      span.footer-separator |--><!--      span= _p('footer.theme') + ' '--><!--      a(href='https://github.com/jerryc127/hexo-theme-butterfly')= 'Butterfly'--><!--  if theme.footer.custom_text--><!--    .footer_custom_text!=`${theme.footer.custom_text}`--></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'myblog-18a8cd',
      region: 'ap-guangzhou'
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'myblog-18a8cd',
      region: 'ap-guangzhou',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.bootcdn.net/ajax/libs/botui/0.3.9/botui.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>